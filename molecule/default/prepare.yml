---
- name: Prepare
  hosts: all
  gather_facts: true
  tasks:
    - name: Update APT cache
      ansible.builtin.package:
        update_cache: yes
      when: ansible_distribution == 'Ubuntu'
      become: true

    - name: Install EPEL for CentOS 9
      ansible.builtin.dnf:
        name: epel-release
        state: present
      when: ansible_os_family == 'RedHat' and ansible_distribution_major_version == '9'
      become: true

    - name: Install EPEL for CentOS 7/8
      ansible.builtin.yum:
        name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm
        state: present
        disable_gpg_check: True
      when: ansible_os_family == 'RedHat' and ansible_distribution_major_version | int < 9
      become: true
